
{
  "name": "NurseBot PRO - Orchestrateur Cabinet v5 - Dynamique",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "nursebot-gateway",
        "options": {}
      },
      "id": "webhook-in",
      "name": "Webhook Gateway",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [0, 400]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Message: {{ $json.body.message }} | Staff Actuel: {{ $json.body.context.cabinetStaff }}",
        "systemMessage": "Tu es l'intelligence centrale 'NurseBot PRO', l'orchestrateur d'un cabinet d'infirmiers lib√©raux (IDEL). \n\n### üë• √âQUIPE & CONTEXTE DYNAMIQUE :\n- Tu re√ßois dans chaque requ√™te la liste actuelle du staff via la variable 'cabinetStaff'.\n- R√àGLE D'OR : Ne jamais utiliser de noms d'infirmi√®res en dur. Utilise uniquement les noms pr√©sents dans 'cabinetStaff'.\n- Si une infirmi√®re est mentionn√©e mais absente de la liste, informe l'utilisateur qu'elle n'est pas configur√©e dans l'onglet 'Staff'.\n\n### üè• MISSIONS & ROUTAGE DES ACTIONS :\n\n1. GESTION DES AGENDAS (Intent: \"PLANNING\") :\n   - Cible l'agenda de l'infirmi√®re identifi√©e.\n   - Donn√©es requises : Nom de l'infirmi√®re, Date, Heure, Type de soin.\n\n2. GESTION DRIVE (Intent: \"DRIVE_CREATE_FOLDER\") :\n   - PRIORIT√â ABSOLUE : Si un patient est nouveau ou si son 'googleDriveFolderId' est manquant, tu DOIS d√©clencher cet intent avant toute autre action documentaire.\n\n3. TRANSMISSIONS (Intent: \"SUPABASE_SYNC\") :\n   - Analyse les passations orales ou √©crites.\n   - Structure les donn√©es en : OBSERVATIONS, VIGILANCE, ACTION.\n\n4. DISCUSSION (Intent: \"CHAT\") :\n   - Pour les questions g√©n√©rales sur le cabinet ou les protocoles.\n\n### üó£Ô∏è TON & POSTURE :\n- Professionnel IDEL (Jargon : BSI, AIS, AMI, Ordonnance ALD).\n- R√©ponses VOCALES (Twilio) : Ultra-concises (max 15 mots).\n- R√©ponses TEXTES (WhatsApp) : D√©taill√©es avec emojis pro.\n\n### üì§ FORMAT DE SORTIE (JSON STRICT) :\nR√©ponds EXCLUSIVEMENT sous ce format JSON :\n{\n  \"reply\": \"Ta r√©ponse √† l'infirmi√®re\",\n  \"intent\": \"PLANNING | DRIVE_CREATE_FOLDER | SUPABASE_SYNC | CHAT\",\n  \"targetNurse\": \"Pr√©nom de l'infirmi√®re concern√©e\",\n  \"patientName\": \"Nom du patient si applicable\",\n  \"actionRequired\": true,\n  \"data\": {\n    \"date\": \"YYYY-MM-DD\",\n    \"time\": \"HH:mm\",\n    \"details\": \"D√©tails de l'action\"\n  }\n}"
      },
      "id": "ai-agent",
      "name": "AI Orchestrator",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1,
      "position": [400, 400]
    },
    {
      "parameters": {
        "modelName": "gemini-1.5-flash"
      },
      "id": "gemini-model",
      "name": "Google Gemini",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [300, 600]
    }
  ],
  "connections": {
    "Webhook Gateway": {
      "main": [
        [
          {
            "node": "ai-agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini": {
      "ai_languageModel": [
        [
          {
            "node": "ai-agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  }
}
